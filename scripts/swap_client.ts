import axios from 'axios';
import { SwapResponse, SwapParam } from '../src/types';
import { formatUnits, parseUnits } from '../src/utils';
import { tokens } from '../src/tokens';
import { logger } from '../src/logging';

import dotenv from 'dotenv';
dotenv.config();

const url = `http://${process.env.SERVER_IP}:${process.env.SERVER_PORT}/swap`;

async function testUniswapV3() {
  const calldata =
    '0xce8c4316000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000f57e7e7c23978c3caec3c3548e3d615c346e79ff00000000000000000000000000000000000000000000000000038d7ea4c6800000000000000000000000000000000000000000000000000016e252c28dd981000000000000000000000000000000000000000000000000000000000062691081000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000038d7ea4c68000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000160000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000100000000000000000000000003f911aedc25c770e701b8f563e8102cfacd62c0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000003f911aedc25c770e701b8f563e8102cfacd62c00000000000000000000000000000000000000000000000000000000000000001000000000000000000002710fd76be67fff3bac84e3d5444167bbc018f5968b60000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000028ea1ea8af97ac00000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000060000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000f57e7e7c23978c3caec3c3548e3d615c346e79ff00000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000000';
  const inputToken = '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'; // WETH
  const outputToken = '0xF57e7e7C23978C3cAEC3C3548E3D615c346e79fF'; //IMX
  const ethValue = '0';

  const query: SwapParam = {
    calldata,
    inputToken,
    outputToken,
    ethValue,
  };

  try {
    const res = await axios.get(url, { params: query });
    const quoteRes = res.data as SwapResponse;
    logger.info(formatUnits(quoteRes.outputAmount, 6));
  } catch (error: any) {
    logger.fatal(`${error.response.data.error}`);
  }
}

async function main() {
  await testUniswapV3();
}

main().catch(console.error);
